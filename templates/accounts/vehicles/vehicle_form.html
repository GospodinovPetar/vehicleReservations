{% extends "base.html" %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/add_vehicle.css' %}">
{% endblock %}

{% block content %}
  <h2 class="page-title">
    {% if form.instance.pk %}Edit Vehicle{% else %}Add Vehicle{% endif %}
  </h2>

  <div class="card">
    <form method="post" novalidate>
      {% csrf_token %}

      {# Non-field errors at the top #}
      {% if form.non_field_errors %}
        <div class="alert error">
          {{ form.non_field_errors|striptags }}
        </div>
      {% endif %}

      <div class="form-grid">
        {# Basics #}
        <div class="form-field">
          <label for="{{ form.name.id_for_label }}">
            {{ form.name.label }}
            {% if form.name.field.required %}<span class="req">*</span>{% endif %}
          </label>
          {{ form.name }}
          {% if form.name.errors %}<div class="field-error">{{ form.name.errors|striptags }}</div>{% endif %}
          {% if form.name.help_text %}<small class="help">{{ form.name.help_text }}</small>{% endif %}
        </div>

        <div class="form-field">
          <label for="{{ form.plate_number.id_for_label }}">
            {{ form.plate_number.label }}
            {% if form.plate_number.field.required %}<span class="req">*</span>{% endif %}
          </label>
          {{ form.plate_number }}
          {% if form.plate_number.errors %}<div class="field-error">{{ form.plate_number.errors|striptags }}</div>{% endif %}
        </div>

        <div class="form-field">
          <label for="{{ form.car_type.id_for_label }}">
            {{ form.car_type.label }}
            {% if form.car_type.field.required %}<span class="req">*</span>{% endif %}
          </label>
          {{ form.car_type }}
          {% if form.car_type.errors %}<div class="field-error">{{ form.car_type.errors|striptags }}</div>{% endif %}
        </div>

        <div class="form-field">
          <label for="{{ form.engine_type.id_for_label }}">
            {{ form.engine_type.label }}
            {% if form.engine_type.field.required %}<span class="req">*</span>{% endif %}
          </label>
          {{ form.engine_type }}
          {% if form.engine_type.errors %}<div class="field-error">{{ form.engine_type.errors|striptags }}</div>{% endif %}
        </div>

        {# NEW: Gearbox #}
        <div class="form-field">
          <label for="{{ form.gearbox.id_for_label }}">
            {{ form.gearbox.label }}
            {% if form.gearbox.field.required %}<span class="req">*</span>{% endif %}
          </label>
          {{ form.gearbox }}
          {% if form.gearbox.errors %}<div class="field-error">{{ form.gearbox.errors|striptags }}</div>{% endif %}
          {% if form.gearbox.help_text %}<small class="help">{{ form.gearbox.help_text }}</small>{% endif %}
        </div>

        <div class="form-field">
          <label for="{{ form.seats.id_for_label }}">
            {{ form.seats.label }}
          </label>
          {{ form.seats }}
          {% if form.seats.errors %}<div class="field-error">{{ form.seats.errors|striptags }}</div>{% endif %}
        </div>

        <div class="form-field">
          <label for="{{ form.price_per_day.id_for_label }}">
            {{ form.price_per_day.label }}
          </label>
            {{ form.price_per_day }}
          {% if form.price_per_day.errors %}<div class="field-error">{{ form.price_per_day.errors|striptags }}</div>{% endif %}
        </div>

        {# --- New spec fields --- #}
        <div class="form-field">
          <label for="{{ form.year_of_manufacturing.id_for_label }}">
            {{ form.year_of_manufacturing.label }}
          </label>
          {{ form.year_of_manufacturing }}
          {% if form.year_of_manufacturing.errors %}<div class="field-error">{{ form.year_of_manufacturing.errors|striptags }}</div>{% endif %}
        </div>

        <div class="form-field">
          <label for="{{ form.top_speed_kmh.id_for_label }}">
            {{ form.top_speed_kmh.label }}
          </label>
          {{ form.top_speed_kmh }}
          {% if form.top_speed_kmh.errors %}<div class="field-error">{{ form.top_speed_kmh.errors|striptags }}</div>{% endif %}
        </div>

        <div class="form-field">
          <label for="{{ form.mileage_km.id_for_label }}">
            {{ form.mileage_km.label }}
          </label>
          {{ form.mileage_km }}
          {% if form.mileage_km.errors %}<div class="field-error">{{ form.mileage_km.errors|striptags }}</div>{% endif %}
        </div>

        <div class="form-field">
          <label for="{{ form.fuel_consumption_l_100km.id_for_label }}">
            {{ form.fuel_consumption_l_100km.label }}
          </label>
          {{ form.fuel_consumption_l_100km }}
          {% if form.fuel_consumption_l_100km.errors %}<div class="field-error">{{ form.fuel_consumption_l_100km.errors|striptags }}</div>{% endif %}
        </div>

        <div class="form-field form-field--full">
          <label for="{{ form.damages.id_for_label }}">
            {{ form.damages.label }}
          </label>
          {{ form.damages }}
          {% if form.damages.errors %}<div class="field-error">{{ form.damages.errors|striptags }}</div>{% endif %}
        </div>

        {# Locations #}
        <div class="form-field form-field--full">
          <label for="{{ form.available_pickup_locations.id_for_label }}">
            {{ form.available_pickup_locations.label }}
          </label>
          {{ form.available_pickup_locations }}
          {% if form.available_pickup_locations.errors %}<div class="field-error">{{ form.available_pickup_locations.errors|striptags }}</div>{% endif %}
        </div>

        <div class="form-field form-field--full">
          <label for="{{ form.available_return_locations.id_for_label }}">
            {{ form.available_return_locations.label }}
          </label>
          {{ form.available_return_locations }}
          {% if form.available_return_locations.errors %}<div class="field-error">{{ form.available_return_locations.errors|striptags }}</div>{% endif %}
        </div>
      </div>

      <div class="form-actions">
        <a class="btn btn-secondary" href="{% url 'accounts:vehicle-list' %}">Cancel</a>
        <button class="btn primary" type="submit">Save</button>
      </div>
    </form>
  </div>

  {% if request.user.role == "admin" %}
      <a href="{% url 'accounts:admin-dashboard' %}" class="btn btn-secondary">← Back to Dashboard</a>
  {% else %}
      <a href="{% url 'accounts:manager-dashboard' %}" class="btn btn-secondary">← Back to Dashboard</a>
  {% endif %}

{% endblock %}
