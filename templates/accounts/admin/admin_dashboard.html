{% extends "base.html" %}
{% block content %}
  <h1>Admin Dashboard</h1>

  <!-- Stats -->
  <div class="stats">
    <p>Total: {{ stats.total }}</p>
    <p>Admins: {{ stats.admins }}</p>
    <p>Managers: {{ stats.managers }}</p>
    <p>Users: {{ stats.users }}</p>
    <p>Blocked: {{ stats.blocked }}</p>
  </div>

  <!-- Quick access -->
  <div style="margin:12px 0;">
    <a class="btn" href="{% url 'accounts:vehicle-list' %}">Manage Vehicles</a>
    <a class="btn" href="{% url 'accounts:reservation-list' %}">Manage Reservations</a>
    <a class="btn" href="{% url 'accounts:location-list' %}">Manage Locations</a>
    <a class="btn" href="/admin/">Django Administration</a>
  </div>

  <!-- Filters/Search -->
  <form method="get">
    <input type="text" name="q" placeholder="Search username/email" value="{{ request.GET.q }}">
    <select name="role">
      <option value="">All Roles</option>
      <option value="admin" {% if request.GET.role == 'admin' %}selected{% endif %}>Admin</option>
      <option value="manager" {% if request.GET.role == 'manager' %}selected{% endif %}>Manager</option>
      <option value="user" {% if request.GET.role == 'user' %}selected{% endif %}>User</option>
    </select>
    <select name="status">
      <option value="">All Status</option>
      <option value="active" {% if request.GET.status == 'active' %}selected{% endif %}>Active</option>
      <option value="blocked" {% if request.GET.status == 'blocked' %}selected{% endif %}>Blocked</option>
    </select>
    <button type="submit" class="btn">Filter</button>
  </form>

  <!-- User Table -->
  <a class="btn primary" href="{% url 'accounts:admin-create-user' %}">+ Create User</a>
  <table>
    <tr>
      <th>Username</th><th>Email</th><th>Role</th><th>Status</th><th>Actions</th>
    </tr>
    {% for u in users %}
  <tr>
    <td>
        <a href="{% url 'accounts:profile-detail' u.pk %}">{{ u.username }}</a>
    </td>
    <td>{{ u.email }}</td>
    <td>{{ u.role }}</td>
    <td>{% if u.is_blocked %}Blocked{% else %}Active{% endif %}</td>
    <td>
      <a href="{% url 'accounts:admin-edit-user' u.id %}">Edit</a> |
      {% if u.is_blocked %}
        <a href="{% url 'accounts:admin-unblock-user' u.id %}">Unblock</a>
      {% else %}
        <a href="{% url 'accounts:admin-block-user' u.id %}">Block</a>
      {% endif %}
      {% if u.role != 'admin' %}
        | <a href="{% url 'accounts:admin-promote-manager' u.id %}">Promote</a>
        | <a href="{% url 'accounts:admin-demote-user' u.id %}">Demote</a>
        | <a href="{% url 'accounts:admin-delete-user' u.id %}">Delete</a>
      {% else %}
        | <span style="color:#999">admin (protected)</span>
      {% endif %}
    </td>
  </tr>
    {% empty %}
      <tr><td colspan="5">No users found.</td></tr>
    {% endfor %}
  </table>
{% endblock %}
