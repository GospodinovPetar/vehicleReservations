<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>WebSocket Echo Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; }
      #log { border: 1px solid #ccc; padding: 1rem; height: 250px; overflow: auto; background: #f9f9f9; }
      .row { margin: .5rem 0; }
      .from-server { color: #0b7285; }
      .from-client { color: #2b8a3e; }
      .status { color: #8a2be2; }
    </style>
  </head>
  <body>
    <h1>WebSocket Echo Test</h1>
    <p>This page connects to <code>ws://&lt;host&gt;/ws/echo/</code> and echoes messages.</p>

    <div class="row">
      <label>WebSocket URL: <input id="wsUrl" size="50" /></label>
      <button id="connectBtn">Connect</button>
      <button id="closeBtn" disabled>Close</button>
    </div>
    <div class="row">
      <input id="msgInput" placeholder="Type a message" size="50" />
      <button id="sendBtn" disabled>Send</button>
    </div>

    <pre id="log"></pre>

    <script>
      const wsUrl = document.getElementById('wsUrl');
      const connectBtn = document.getElementById('connectBtn');
      const closeBtn = document.getElementById('closeBtn');
      const sendBtn = document.getElementById('sendBtn');
      const msgInput = document.getElementById('msgInput');
      const log = document.getElementById('log');

      // Default to current host
      wsUrl.value = (location.protocol === 'https:' ? 'wss://' : 'ws://') + location.host + '/ws/echo/';

      let ws;
      const add = (text, cls = 'status') => {
        const div = document.createElement('div');
        div.className = cls;
        div.textContent = text;
        log.appendChild(div);
        log.scrollTop = log.scrollHeight;
      };

      connectBtn.onclick = () => {
        if (ws && ws.readyState === WebSocket.OPEN) return;
        ws = new WebSocket(wsUrl.value);
        add('Connecting to ' + wsUrl.value + ' ...');
        ws.onopen = () => {
          add('Connected', 'status');
          sendBtn.disabled = false;
          closeBtn.disabled = false;
        };
        ws.onmessage = (ev) => add('Server: ' + ev.data, 'from-server');
        ws.onclose = () => {
          add('Closed', 'status');
          sendBtn.disabled = true;
          closeBtn.disabled = true;
        };
        ws.onerror = (e) => add('Error: ' + (e.message || 'see console'), 'status');
      };

      closeBtn.onclick = () => { if (ws) ws.close(); };
      sendBtn.onclick = () => {
        if (!ws || ws.readyState !== WebSocket.OPEN) return;
        const msg = msgInput.value || 'Hello!';
        ws.send(msg);
        add('You: ' + msg, 'from-client');
        msgInput.value = '';
      };

      msgInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') sendBtn.click(); });
    </script>
  </body>
</html>
